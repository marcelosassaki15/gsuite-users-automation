# gsuite-users-automation
Automated solution of creation and deletion users that uses from opened ticket on Jira Service Management to Google Admin.
This repository contains Terraform and Python (AWS Lambda) codes.

## Replace the *json* and *zip* files and check the variables
1. Generate the json credential on GCP Google Credentials
2. Enter the *files* folder and replace the following files:
```
- json credential of service account generated by Google Credentials. The credential hosted here is out of service!
- lambda_function.zip (Python codes for AWS Lambda) is a compressed file with the Google libraries and the lambda_function.py that has the core of processing Lambdas. To do this, in a local environment (on your computer), create a local folder, open Terminal, enter that folder and run the command:

$ pip install --upgrade google-api-python-client google-auth-httplib2 google-auth-oauthlib -t ./

After that, use the lambda_function.py inside lambda_function.zip file, put it on other local folder with Google libraries and compress that. It is the compressed file used by Terraform here.
```
3. Make sure these files are with the same name. If not, change the values located on *variables.tf*.
4. In this file, change the value on variable *delegated_account* that has Administrator permissions on GSuite Admin (it is recommended do not change the *prefix* and *prod_stage* values!). The region used is *us-west-2*

## Building the remote-state and lock state for Terraform structure
1. On Terminal, enter the *remote-state* folder and run the command:
```
terraform init
terraform apply
```

## Building the remote-state and lock state for Terraform structure
1. On the same Terminal session, go to *root* folder and run the following codes:
```
terraform init
terraform apply
```
2. After all, get the invoke URL for POST requests and the API key on AWS API Gateway (Plan usage > API keys section) to use on Jira Service Management automation, configuring *Send web request* with web request URL (invoke URL on API Gateway created by this Terraform) and the header (x-api-key and the value found in AWS API Gateway)

## Destroying the Terraform structure
1. Use **terraform destroy** in the *root* and *remote-state* (do not forget to empty the s3 folder on remote state) folders.
